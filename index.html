<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fahn-Tolosa - Evaluación Integral</title>
    <style>
        :root { 
            --azul-oscuro: #0a2558; 
            --azul-medio: #1e56a0; 
            --azul-claro: #d6e4f0;
            --gris-fondo: #f9f9f9;
            --blanco: #ffffff;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--azul-claro); color: #333; margin: 0; padding: 15px; }
        .container { max-width: 900px; margin: auto; background: var(--blanco); padding: 25px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
        
        h1 { color: var(--azul-oscuro); text-align: center; margin-bottom: 5px; font-size: 1.8em; border-bottom: 2px solid var(--azul-oscuro); padding-bottom: 10px; }
        
        /* Pestañas */
        .tabs { display: flex; justify-content: center; margin-bottom: 20px; gap: 5px; }
        .tab-btn { padding: 12px; cursor: pointer; border: none; background: #ccc; color: #666; font-weight: bold; border-radius: 5px 5px 0 0; transition: 0.3s; flex: 1; text-align: center; }
        .tab-btn.active { background: var(--azul-oscuro); color: white; }

        .datos-clinicos { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; background: var(--gris-fondo); padding: 20px; border: 1px solid var(--azul-claro); border-radius: 6px; margin-bottom: 20px; }
        .field label { font-weight: bold; font-size: 0.9em; color: var(--azul-oscuro); display: block; margin-bottom: 5px; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }

        .seccion-contenido { display: none; }
        .seccion-contenido.active { display: block; }

        /* Tarjetas de Items */
        .pregunta-card { border: 1px solid #e1e8ed; margin-bottom: 15px; border-radius: 6px; overflow: hidden; }
        .titulo-preg { background: var(--azul-oscuro); color: var(--blanco); padding: 10px 15px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        .subtotal-preg { background: var(--azul-claro); color: var(--azul-oscuro); padding: 2px 10px; border-radius: 4px; font-size: 0.9em; }
        
        .cuerpo-preg { padding: 15px; }
        .sub-seccion { margin-bottom: 12px; }
        .sub-seccion label { font-size: 0.85em; font-weight: bold; color: var(--azul-medio); display: block; margin-bottom: 5px; }
        
        select { width: 100%; padding: 10px; border: 1px solid var(--azul-claro); border-radius: 4px; font-size: 0.9em; background: #fff; }

        .footer-totales { margin-top: 30px; padding: 20px; background: var(--azul-oscuro); color: white; border-radius: 8px; }
        .totales-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; text-align: center; }
        .total-item span { display: block; font-size: 1.4em; font-weight: bold; color: var(--azul-claro); }
        .total-global-item { border-top: 1px solid #ffffff44; padding-top: 10px; margin-top: 10px; grid-column: 1 / -1; font-size: 1.1em; }
        
        .observaciones { margin: 20px 0; }
        textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; resize: none; }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button.action-btn { flex: 1; padding: 15px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-pdf { background: var(--azul-medio); color: white; }

        /* REPORTE PDF (Oculto en web) */
        #pdf-report { display: none; }

        @media print {
            @page { size: portrait; margin: 1cm; }
            .no-print, .tabs, .pregunta-card, .btn-group { display: none !important; }
            .container { box-shadow: none; border: none; width: 100%; padding: 0; }
            #pdf-report { display: block !important; }
            .pdf-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 10pt; }
            .pdf-table th, .pdf-table td { border: 1px solid #ddd; padding: 6px; text-align: left; }
            .pdf-table th { background: #f2f2f2; }
            .footer-totales { background: white !important; color: black !important; border: 2px solid black; }
            .total-item span { color: black !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Escala de Evaluación del Temblor - Fahn Tolosa</h1>
    
    <div class="datos-clinicos">
        <div class="field"><label>Paciente:</label><input type="text" id="nombre"></div>
        <div class="field"><label>Fecha:</label><input type="date" id="fecha"></div>
        <div class="field"><label>Diagnóstico:</label><input type="text" id="diagnostico"></div>
    </div>

    <div class="tabs no-print">
        <div class="tab-btn active" onclick="showTab('parteA')">PARTE A</div>
        <div class="tab-btn" onclick="showTab('parteB')">PARTE B</div>
        <div class="tab-btn" onclick="showTab('parteC')">PARTE C</div>
    </div>

    <div id="parteA" class="seccion-contenido active"></div>
    <div id="parteB" class="seccion-contenido"></div>
    <div id="parteC" class="seccion-contenido"></div>

    <div id="pdf-report">
        <h3 style="text-align:center; border-bottom: 1px solid #000;">Desglose Detallado de Evaluación</h3>
        <table class="pdf-table">
            <thead><tr><th>Sección / Ítem</th><th>Detalle de Puntajes</th><th>Subtotal</th></tr></thead>
            <tbody id="pdf-table-body"></tbody>
        </table>
    </div>

    <div class="observaciones">
        <label style="font-weight:bold; color: var(--azul-oscuro);">Observaciones Clínicas:</label>
        <textarea id="obs"></textarea>
    </div>

    <div class="footer-totales">
        <div class="totales-grid">
            <div class="total-item">PARTE A <span id="total-A">0 / 80</span></div>
            <div class="total-item">PARTE B <span id="total-B">0 / 36</span></div>
            <div class="total-item">PARTE C <span id="total-C">0 / 32</span></div>
            <div class="total-item total-global-item">TOTAL GLOBAL (A+B+C) <span id="total-global">0 / 148</span></div>
        </div>
        <div class="btn-group no-print">
            <button class="action-btn btn-pdf" onclick="window.print()">Imprimir / Guardar PDF</button>
        </div>
    </div>
</div>

<script>
document.getElementById('fecha').valueAsDate = new Date();

const configA = [
    { t: "Temblor facial", s: ["Reposo", "Postural"] },
    { t: "Temblor lingual", s: ["Reposo", "Postural"] },
    { t: "Temblor de la voz", s: ["Acción"] },
    { t: "Temblor de la cabeza", s: ["Reposo", "Postural"] },
    { t: "M.S. Derecho", s: ["Reposo", "Postural", "Acción"] },
    { t: "M.S. Izquierdo", s: ["Reposo", "Postural", "Acción"] },
    { t: "Tronco", s: ["Reposo", "Postural"] },
    { t: "M.I. Derecho", s: ["Reposo", "Postural", "Acción"] },
    { t: "M.I. Izquierdo", s: ["Reposo", "Postural", "Acción"] },
    { t: "Temblor ortostático", s: ["Postural"] }
];

const configB = [
    { t: "Escritura", s: ["Derecha", "Izquierda"], op: ["0: Normal.", "1: Levemente anormal. Escritura algo desordenada, temblorosa.", "2: Moderadamente anormal. Legible, pero con temblor considerable.", "3: Marcadamente anormal. Ilegible.", "4: Gravemente anormal. Incapaz de mantener el lápiz sobre el papel."] },
    { t: "Espiral Grande", s: ["Derecha", "Izquierda"], op: ["0: Normal.", "1: Levemente tembloroso. Puede cruzar las lineas ocasionalmente.", "2: Moderadamente tembloroso o cruza las lineas frecuentemente.", "3: Realiza la tarea con gran dificultad, muchos errores.", "4: Incapaz de completarla."] },
    { t: "Espiral Pequeño", s: ["Derecha", "Izquierda"], op: ["0: Normal.", "1: Levemente tembloroso. Puede cruzar las lineas ocasionalmente.", "2: Moderadamente tembloroso o cruza las lineas frecuentemente.", "3: Realiza la tarea con gran dificultad, muchos errores.", "4: Incapaz de completarla."] },
    { t: "Rectas", s: ["Derecha", "Izquierda"], op: ["0: Normal.", "1: Levemente tembloroso. Puede cruzar las lineas ocasionalmente.", "2: Moderadamente tembloroso o cruza las lineas frecuentemente.", "3: Realiza la tarea con gran dificultad, muchos errores.", "4: Incapaz de completarla."] },
    { t: "Manejo de Vasos", s: ["Derecha", "Izquierda"], op: ["0: Normal.", "1: Con más cuidado pero sin derramar.", "2: Derrama pequeña cantidad (<10%).", "3: Derrama bastante (10-50%).", "4: Incapaz de hacerlo sin derramar casi todo."] }
];

const configC = [
    { t: "Hablar", s: ["Voz"], op: ["0: Normal.", "1: Temblor leve, solo al estar nervioso.", "2: Temblor leve, constante.", "3: Temblor moderado.", "4: Temblor grave. Palabras difíciles de entender."] },
    { t: "Comer", s: ["Alimentación"], op: ["0: Normal.", "1: Levemente anormal. Derrama raramente.", "2: Moderadamente anormal. Derrama con frecuencia.", "3: Marcadamente anormal. Usa las dos manos.", "4: Gravemente anormal. Necesita ayuda."] },
    { t: "Beber", s: ["Líquidos"], op: ["0: Normal.", "1: Levemente anormal. Cuchara no llena.", "2: Moderadamente anormal. Usa tazas/vasos.", "3: Marcadamente anormal. Necesita las dos manos.", "4: Gravemente anormal. Usa pajita."] },
    { t: "Asearse", s: ["Higiene"], op: ["0: Normal.", "1: Levemente anormal. Más cuidado.", "2: Moderadamente anormal. Errores frecuentes.", "3: Marcadamente anormal. Usa las dos manos.", "4: Gravemente anormal. Incapaz."] },
    { t: "Vestirse", s: ["Vestimenta"], op: ["0: Normal.", "1: Levemente anormal. Más cuidado.", "2: Moderadamente anormal. Errores frecuentes.", "3: Marcadamente anormal. Ayuda para botones/zapatos.", "4: Gravemente anormal. Ayuda total."] },
    { t: "Escribir", s: ["Funcionalidad"], op: ["0: Normal.", "1: Levemente anormal. Escribe cartas.", "2: Moderadamente anormal. Ya no escribe cartas.", "3: Marcadamente anormal. Ilegible.", "4: Gravemente anormal. No firma."] },
    { t: "Trabajar", s: ["Laboral"], op: ["0: Normal.", "1: Más cuidado.", "2: Menor rendimiento.", "3: Incapaz de trabajo habitual.", "4: Incapaz de cualquier trabajo."] },
    { t: "Actividades sociales", s: ["Social"], op: ["0: Sin cambios.", "1: Cambio mínimo.", "2: Evita desconocidos.", "3: Evita amigos.", "4: Evita encuentros públicos."] }
];

const escalaA = ["0: Normal", "1: Leve, imperceptible (<2cm)", "2: Moderado (<2cm)", "3: Marcado (2-4cm)", "4: Grave (>4cm)"];

function render(id, datos, escalaBase) {
    const contenedor = document.getElementById(id);
    datos.forEach((preg, pIdx) => {
        const escala = preg.op || escalaBase;
        let html = `<div class="pregunta-card"><div class="titulo-preg"><span>${preg.t}</span><span class="subtotal-preg" id="sub-${id}-${pIdx}">0 pts</span></div><div class="cuerpo-preg">`;
        preg.s.forEach((sec, sIdx) => {
            html += `<div class="sub-seccion"><label>${sec}</label><select class="score-input" data-secc="${id}" data-parent="${pIdx}" data-label="${sec}" onchange="calcular()">${escala.map((t, i) => `<option value="${i}">${t}</option>`).join('')}</select></div>`;
        });
        contenedor.innerHTML += html + `</div></div>`;
    });
}

function showTab(tab) {
    document.querySelectorAll('.seccion-contenido, .tab-btn').forEach(el => el.classList.remove('active'));
    document.getElementById(tab).classList.add('active');
    event.currentTarget.classList.add('active');
}

function calcular() {
    let tA = 0, tB = 0, tC = 0;
    let pdfRows = "";

    const calcParte = (id, config, label) => {
        let totalSecc = 0;
        pdfRows += `<tr><th colspan="3" style="background:#eee">PARTE ${label}</th></tr>`;
        config.forEach((p, i) => {
            let suma = 0;
            let detalles = [];
            const selects = document.querySelectorAll(`.score-input[data-secc="${id}"][data-parent="${i}"]`);
            
            if(id === 'parteB' && p.t === "Escritura") {
                suma = Math.max(parseInt(selects[0].value), parseInt(selects[1].value));
                detalles.push(`Máx(D:${selects[0].value}, I:${selects[1].value})`);
            } else {
                selects.forEach(s => {
                    let v = parseInt(s.value);
                    suma += v;
                    detalles.push(`${s.dataset.label}: ${v}`);
                });
            }
            document.getElementById(`sub-${id}-${i}`).innerText = `${suma} pts`;
            totalSecc += suma;
            pdfRows += `<tr><td>${p.t}</td><td>${detalles.join(' | ')}</td><td>${suma}</td></tr>`;
        });
        return totalSecc;
    };

    tA = calcParte('parteA', configA, 'A');
    tB = calcParte('parteB', configB, 'B');
    tC = calcParte('parteC', configC, 'C');

    document.getElementById('total-A').innerText = `${tA} / 80`;
    document.getElementById('total-B').innerText = `${tB} / 36`;
    document.getElementById('total-C').innerText = `${tC} / 32`;
    document.getElementById('total-global').innerText = `${tA + tB + tC} / 148`;
    document.getElementById('pdf-table-body').innerHTML = pdfRows;
}

render('parteA', configA, escalaA);
render('parteB', configB, null);
render('parteC', configC, null);
calcular();
</script>
</body>
</html>